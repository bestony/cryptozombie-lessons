---
title: ä¿æŒæ¸¸æˆçš„è¶£å‘³æ€§ï¼ˆç»­ï¼‰
actions: ["checkAnswer", "hints"]
requireLogin: true
material:
  editor:
    language: javascript
    startingCode:
      "test/CryptoZombies.js": |
        const CryptoZombies = artifacts.require("CryptoZombies");
        const utils = require("./helpers/utils");
        const zombieNames = ["Zombie 1", "Zombie 2"];
        contract("CryptoZombies", (accounts) => {
            let [alice, bob] = accounts;
            let contractInstance;
            beforeEach(async () => {
                contractInstance = await CryptoZombies.new();
            });
            it("should be able to create a new zombie", async () => {
                const result = await contractInstance.createRandomZombie(zombieNames[0], {from: alice});
                assert.equal(result.receipt.status, true);
                assert.equal(result.logs[0].args.name,zombieNames[0]);
            })
            it("should not allow two zombies", async () => {
                // start here
            })
        })
      "test/helpers/utils.js": |
        async function shouldThrow(promise) {
          try {
              await promise;
             assert(true);
          }
          catch (err) {
              return;
          }
        assert(false, "The contract did not throw.");

        }

        module.exports = {
          shouldThrow,
        };

    answer: >
      const CryptoZombies = artifacts.require("CryptoZombies");

      const utils = require("./helpers/utils");

      const zombieNames = ["Zombie 1", "Zombie 2"];

      contract("CryptoZombies", (accounts) => {
          let [alice, bob] = accounts;
          let contractInstance;
          beforeEach(async () => {
              contractInstance = await CryptoZombies.new();
          });
          it("should be able to create a new zombie", async () => {
              const result = await
      contractInstance.createRandomZombie(zombieNames[0], {from: alice});
              assert.equal(result.receipt.status, true);
              assert.equal(result.logs[0].args.name,zombieNames[0]);
          })
          it("should not allow two zombies", async () => {
              await contractInstance.createRandomZombie(zombieNames[0], {from:
      alice});
              await
      utils.shouldThrow(contractInstance.createRandomZombie(zombieNames[1],
      {from: alice}));
          })
      })
---

åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¡«å……ç¬¬äºŒä¸ªæµ‹è¯•çš„ä¸»ä½“ã€‚æ˜¯è¿™æ ·:

- é¦–å…ˆï¼ŒAlice åº”è¯¥è°ƒç”¨ `createRandomZombie` å¹¶å°†å®ƒå‘½åä¸º `zombieNames[0]`ï¼Œ ä½œä¸º
  å¥¹ç¬¬ä¸€ä¸ªåƒµå°¸çš„åå­—ã€‚
- æ¥ä¸‹æ¥ï¼ŒAlice åº”è¯¥å°è¯•åˆ›å»ºå¥¹çš„ç¬¬äºŒä¸ªåƒµå°¸ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡åº”è¯¥å°†åƒµå°¸åè®¾ç½®ä¸º
  `zombieNames[1]`ã€‚
- æ­¤æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›åˆçº¦`æŠ¥é”™`ã€‚
- ç”±äºæˆ‘ä»¬çš„æµ‹è¯•åº”è¯¥åªåœ¨æ™ºèƒ½åˆçº¦å‡ºé”™æ—¶é€šè¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é€»è¾‘çœ‹èµ·æ¥ä¼šæœ‰ç‚¹ä¸åŒã€‚æˆ‘ä»¬
  å°†éœ€è¦å°è£…ç¬¬äºŒä¸ª `createRandomZombie` å‡½æ•°è°ƒç”¨å†…çš„ä¸€ä¸ª `try/catch` å—ï¼Œå¦‚ä¸‹:

```javascript
try {
  //try to create the second zombie
  await contractInstance.createRandomZombie(zombieNames[1], { from: alice });
  assert(true);
} catch (err) {
  return;
}
assert(false, "The contract did not throw.");
```

ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æƒ³è¦çš„ï¼Œå¯¹å§?

å‘ƒâ€¦â€¦ å°±å·®ä¸€ç‚¹ç‚¹äº†ã€‚

ä¸ºäº†ä¿æŒæµ‹è¯•æ•´æ´ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„ä»£ç ç§»åˆ°äº† `helpers/utils.js` ä¸­ï¼Œå¹¶å°†å…¶å¯¼å…¥åˆ°
â€œCryptoZombies.jsâ€ï¼Œåƒè¿™æ ·:

```javascript
const utils = require("./helpers/utils");
```

è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç è¡Œæ˜¯è¿™æ ·çš„:

```javascript
await utils.shouldThrow(myAwesomeContractInstance.myAwesomeFunction());
```

# å®æˆ˜æ¼”ä¹

å‰ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¸ºç¬¬äºŒä¸ªæµ‹è¯•åˆ›å»ºäº†ä¸€ä¸ªç©º shellã€‚ç°åœ¨æ¥å¡«å……å§ã€‚

1.  é¦–å…ˆï¼Œè®© Alice åˆ›é€ å¥¹çš„ç¬¬ä¸€ä¸ªåƒµå°¸ã€‚å°†å®ƒå‘½åä¸º `zombieNames[0]`ï¼Œåˆ«å¿˜è®°æ­£ç¡®è®¾
    ç½®å…¶ä¸»äººã€‚

2.  åœ¨ Alice åˆ›å»ºäº†å¥¹çš„ç¬¬ä¸€ä¸ªåƒµå°¸åï¼Œç”¨ `createRandomZombie` ä½œä¸ºå‚æ•°è¿
    è¡Œ`shouldThrow`ã€‚å¦‚æœä¸è®°å¾—è¿™ä¸ªçš„è¯­æ³•ï¼Œè¯·æŸ¥çœ‹ä¸Šé¢çš„ç¤ºä¾‹ã€‚ä½†è¯·å…ˆè‡ªå·±å°è¯•ï¼Œä¸
    è¦å·çœ‹å“Ÿã€‚

å¤ªæ£’äº†ï¼Œä½ åˆšåˆšå·²ç»å®Œæˆäº†ä½ çš„ç¬¬äºŒä¸ªæµ‹è¯•ï¼

ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­ä¸ºä½ è¿è¡Œ `truffle test`ã€‚è¾“å‡º:

```bash
Contract: CryptoZombies
    âœ“ should be able to create a new zombie (129ms)
    âœ“ should not allow two zombies (148ms)


  2 passing (1s)
```

æµ‹è¯•é€šè¿‡å•¦ï¼ æ¬§è€¶!
